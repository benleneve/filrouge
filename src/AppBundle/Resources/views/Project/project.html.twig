{% extends "AppBundle::layout.html.twig" %}

{% block breadcrumb %}
    {{parent()}} > 
        <a href="{{path('filrouge_project_list')}}">Projets</a> >
        <a href="{{path('filrouge_project_detail', {'id': project.id } )}}">{{project.name}}</a>
{% endblock breadcrumb %}

{% block left %}
    
    <div class="blockGeneral">
        <h2 class="icoProject">Projet</h2>
        <div class="blockContent">
            <div class="headerBlock">
                <div class="name">
                    <h3>{{project.name}}</h3>
                </div>
                <div class="status">
                    {% if project.status.name == 'En attente' %}
                        {{project.status.name}}
                        <img alt="En attente" src="{{asset('bundles/app/images/status_orange.png')}}" />
                    {% elseif project.status.name == 'En cours' %}
                        {{project.status.name}}
                        <img alt="En Cours" src="{{asset('bundles/app/images/status_green.png')}}" />
                    {% elseif project.status.name == 'Terminé' %}
                        {{project.status.name}}
                        <img alt="Terminé" src="{{asset('bundles/app/images/status_red.png')}}" />
                    {% endif %}
                </div>
                <div class="clear"></div>
            </div>
            <div class="bodyBlock">
                <div class="dateProject">
                    <div class="startDate">
                        <h4>Date de début</h4>
                        {{project.startDate|date('d/m/Y')}} 
                    </div>
                    <div class="endDate">
                        <h4>Date de fin</h4>
                        {{project.endDate|date('d/m/Y')}}
                    </div>
                    <div class="clear"></div>
                </div>
                <h4>Chef de projet</h4>
                {{project.projectManager.firstName}} {{project.projectManager.lastName}}
                <h4>Objectif</h4>
                {{project.purpose}}
                <h4>Description</h4>
                {{project.description}}
                
                {% if (project.projectSkills|length !=0) %}
                    <h4>Compétences manquantes</h4>
                    {% for projectSkill in project.projectSkills %}
                        <div class="projectSkill">
                            <div class="name">
                                {{projectSkill.skill.name}}
                            </div>
                            <div class="action">
                            {% if projectSkill.active %}
                                {% if (projectSkill.applicants|length !=0) %}
                                    {% if app.user.id in projectSkill.applicants %}
                                        <div class="validateOnHold">   
                                            Validation en cours
                                        </div>
                                    {% else %}    
                                        <a href=" {{path('filrouge_project_apply', {'id': project.id, 'idProjectSkill': projectSkill.id } )}}" class="btnAction">> Postuler</a>
                                    {% endif %}
                                {% else %}
                                    <a href=" {{path('filrouge_project_apply', {'id': project.id, 'idProjectSkill': projectSkill.id } )}}" class="btnAction">> Postuler</a>
                                {% endif %}     
                            {% else %}
                                <div class="finish">
                                    Recruté
                                </div>
                            {% endif %}
                            </div>
                            {% if  message is defined and skillName == projectSkill.skill.name %}
                            <div class="postulate">  
                                Votre candidature a bien été envoyée  
                            </div>
                            {% endif %}
                            <div class="clear"></div>
                        </div>         
                    {% endfor %}
                {% else %}
                    <h4>Aucune compétence demandée pour ce projet</h4>
                {% endif %}
                
                {% if (project.steps|length !=0) %}
                    <h4>Avancement du projet</h4>
                    {% for step in project.steps %}
                        <div class="projectStep">
                            <div class="name">
                                {{step.name}}
                            </div>
                            <div class="action">
                                {% if step.status.name == 'En attente' %}
                                    <div class="onHold">
                                        {{step.status.name}}
                                    </div>
                                {% elseif step.status.name == 'En cours' %}
                                    <div class="inProgress">
                                        {{step.status.name}}
                                    </div>
                                {% elseif step.status.name == 'Terminé' %}
                                    <div class="finish">
                                        {{step.status.name}}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="clear"></div>
                        </div>
                    {% endfor %}
                {% else %}
                    <h4>Aucune étape renseignée pour ce projet</h4>
                {% endif %}
                
                {% if (project.projectMembers|length !=0) %}
                    <h4>Membres du projet</h4>
                    {% set cpt = true %}
                    {% for member in project.projectMembers %} 
                        {% if member.active %}
                            <div class="projectMember">
                                <div class="nameMember">
                                    {{member.user.firstName}} {{member.user.LastName}}
                                </div>
                                <div class="skillMember">
                                    {{member.skill}}
                                </div>
                                <div class="clear"></div>
                            </div>
                            <div class="clear"></div>
                        {% else %} 
                            {% if cpt %}   
                                Des membres sont en attente de validation par le chef de project
                                {% set cpt = false %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <h4>Aucun membre n'a rejoint ce projet</h4>
                {% endif %}
            </div>
        </div>    
    </div>
    {% if app.user.id == project.projectManager.id %} 
        <div class="projectUpdate">
           <a href=" {{path('filrouge_project_update', {'id': project.id } )}} " class="btnAction">> Modifier mon projet</a>
        </div>
    {% endif %}
     
{% endblock left %}
